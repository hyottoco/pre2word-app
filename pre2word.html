<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>英単語テスト（重複なしランダム）</title>
  <style>
    body { font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
           margin: 0; padding: 20px; }
    .card { max-width: 720px; margin: 0 auto; padding: 18px; border: 1px solid #ddd; border-radius: 14px; }
    .top { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { font-size: 14px; padding: 6px 10px; border-radius: 999px; border: 1px solid #ddd; }
    .word { font-size: 44px; font-weight: 700; margin: 18px 0 10px; line-height: 1.1; }
    .meaning { font-size: 28px; margin: 10px 0 0; min-height: 40px; }
    .hint { color:#666; font-size:14px; margin-top: 10px; }
    .btns { display:flex; gap:10px; margin-top: 18px; flex-wrap: wrap; }
    button { font-size: 18px; padding: 12px 14px; border-radius: 12px; border: 1px solid #ddd; background: #fff; }
    button:active { transform: translateY(1px); }
    .primary { font-weight: 700; }
    .danger { border-color:#f2c; }
  </style>
</head>
<body>
  <div class="card">
    <div class="top">
      <div class="badge" id="progress">0 / 0</div>
      <div class="badge" id="mode">英→日</div>
    </div>

    <div class="word" id="word">（単語リストを入れてください）</div>
    <div class="meaning" id="meaning"></div>
    <div class="hint" id="hint">ボタン：英語表示 → 日本語表示 → 次の英語 …</div>

    <div class="btns">
      <button class="primary" id="nextBtn">はじめる</button>
      <button id="resetBtn" class="danger">リセット（最初から）</button>
    </div>
  </div>

<script>
/**
 * ▼ここに単語リストを貼ります（650語）
 * 形式： { en: "apple", ja: "りんご" }
 */
const VOCAB = [
  // 例（ここをあなたの650語で置き換え）
  { en: "decide", ja: "決める" },
  { en: "continue", ja: "続ける" },
  { en: "increase", ja: "増える／増やす" },
  { en: "reduce", ja: "減らす" },
  { en: "provide", ja: "提供する" },
  // ...ここに続けて650語分...
];

// ======== 保存キー（iPad内に保存） ========
const KEY = "vocab_app_state_v1";

// ======== Fisher–Yates shuffle ========
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function freshState() {
  const order = shuffle([...Array(VOCAB.length).keys()]);
  return {
    order,          // 出題順（VOCABのindex配列）
    index: 0,       // いま何問目（0-based）
    phase: 0,       // 0=英語表示, 1=日本語表示
  };
}

function loadState() {
  try {
    const raw = localStorage.getItem(KEY);
    if (!raw) return null;
    const st = JSON.parse(raw);
    // 簡単な整合性チェック
    if (!st || !Array.isArray(st.order) || typeof st.index !== "number" || typeof st.phase !== "number") return null;
    if (st.order.length !== VOCAB.length) return null;
    if (st.index < 0 || st.index > VOCAB.length) return null;
    if (st.phase !== 0 && st.phase !== 1) return null;
    return st;
  } catch {
    return null;
  }
}

function saveState(st) {
  localStorage.setItem(KEY, JSON.stringify(st));
}

function setUI(st) {
  const wordEl = document.getElementById("word");
  const meaningEl = document.getElementById("meaning");
  const progressEl = document.getElementById("progress");
  const btn = document.getElementById("nextBtn");

  // 1周終わったら新しいシャッフルで再スタート（重複なしは1周内）
  if (st.index >= VOCAB.length) {
    st = freshState();
    saveState(st);
  }

  const current = VOCAB[st.order[st.index]];

  progressEl.textContent = `${st.index + 1} / ${VOCAB.length}`;

  if (st.phase === 0) {
    wordEl.textContent = current.en;
    meaningEl.textContent = "";
    btn.textContent = "日本語を表示（答え合わせ）";
  } else {
    wordEl.textContent = current.en;
    meaningEl.textContent = current.ja;
    btn.textContent = "次へ";
  }
}

function nextAction() {
  let st = loadState();
  if (!st) st = freshState();

  // phase 0 → 1（日本語表示）
  if (st.phase === 0) {
    st.phase = 1;
  } else {
    // phase 1 → 次の問題へ（英語表示）
    st.phase = 0;
    st.index += 1;
  }
  saveState(st);
  setUI(st);
}

function resetAll() {
  const st = freshState();
  saveState(st);
  setUI(st);
}

function init() {
  if (!VOCAB.length) {
    document.getElementById("word").textContent = "VOCABが空です（単語リストを入れてください）";
    return;
  }
  let st = loadState();
  if (!st) {
    st = freshState();
    saveState(st);
  }
  setUI(st);

  document.getElementById("nextBtn").addEventListener("click", nextAction);
  document.getElementById("resetBtn").addEventListener("click", resetAll);
}

init();
</script>
</body>
</html>
